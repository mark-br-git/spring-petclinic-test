pipeline {
    agent any


    stages {


        stage('Bump Version and Create Tag') {

 
            steps {
                script {
      withCredentials([usernamePassword(credentialsId: 'git', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')]) {
                
                    def currentTag = sh(returnStdout: true, script: 'git describe --abbrev=0 --tags').trim()
                    def newVersion = sh(returnStdout: true, script: "python3 semver_script.py $currentTag")
   sh "echo $USERNAME"
   sh "echo $PASSWORD"
                    sh "git tag $newVersion"
                //    sh "git push origin $newVersion -u mark-br-git -p $PASSWORD"
                    sh "git push https://$USERNAME:$PASSWORD@github.com/mark-br-git/spring-petclinic-test.git 1.2.0"
                    }
                }
            }
        }
    }
}



